import random

ПродолжениеИгры="Да"
while ПродолжениеИгры =="Да":
    while True:
        try:
            РазмерПоля= int(input("Это игра в крестики - нолики\nВыберите размер игрового поля (3-9): "))
        
            if 3<=РазмерПоля<=9:
                print("Поле подходит по размерам")
                break
            else:
                print("Неверный выбор размера поля, выберите ещё раз...")
        except ValueError:
            print("Ошибка! Введите целое число от 3 до 9")
    while True:
        try:
            ВыборРежимаИгры = int(input("Выберите режим игры 1. Против игрока "))
            if ВыборРежимаИгры ==1:
                print("Вы выбрали режим игры против другого игрока")
                break
            else:
                print("Неверный выбор режима игры, выберите ещё раз...")
        except ValueError:
            print("Ошибка! Введите 1")

    ИмяПервогоИгрока = str(input("Введите имя первого игрока: "))
    ИмяВторогоИгрока = str(input("Введите имя второго игрока: "))
    РандомныйИгрок = random.randint(1, 2)
    
    # Создаем поле
    поле = []
    for i in range(РазмерПоля):
        строка = []
        for j in range(РазмерПоля):
            строка.append('.')
        поле.append(строка)
    
    # Определяем кто ходит первым
    if РандомныйИгрок == 1:
        print("Первым ходит игрок:", ИмяПервогоИгрока, "(X)")
        текущий_игрок = ИмяПервогоИгрока
        текущий_символ = 'X'
        следующий_игрок = ИмяВторогоИгрока
        следующий_символ = 'O'
    else:
        print("Первым ходит игрок:", ИмяВторогоИгрока, "(X)")
        текущий_игрок = ИмяВторогоИгрока
        текущий_символ = 'X'
        следующий_игрок = ИмяПервогоИгрока
        следующий_символ = 'O'
    
    # Показываем начальное поле
    print("\nНачальное поле:")
    print("  ", end="")
    for i in range(РазмерПоля):
        print(str(i+1) + " ", end="")
    print()
    
    for i in range(РазмерПоля):
        print(str(i+1) + " ", end="")
        for j in range(РазмерПоля):
            print(поле[i][j] + " ", end="")
        print()
    
    игра_закончена = False
    ход_номер = 0
    
    while not игра_закончена:
        ход_номер += 1
        print("\nХодит", текущий_игрок, "(" + текущий_символ + ")")
        
        # Ход игрока
        while True:
            try:
                строка = int(input("Выберите номер строки (1-" + str(РазмерПоля) + "): "))
                столбец = int(input("Выберите номер столбца (1-" + str(РазмерПоля) + "): "))
                
                if 1 <= строка <= РазмерПоля and 1 <= столбец <= РазмерПоля:
                    if поле[строка-1][столбец-1] == '.':
                        поле[строка-1][столбец-1] = текущий_символ
                        break
                    else:
                        print("Эта клетка уже занята! Выберите другую.")
                else:
                    print("Неверные координаты! Попробуйте снова.")
            except ValueError:
                print("Ошибка! Введите числа.")
        
        # Показываем поле после хода
        print("\nТекущее поле:")
        print("  ", end="")
        for i in range(РазмерПоля):
            print(str(i+1) + " ", end="")
        print()
        
        for i in range(РазмерПоля):
            print(str(i+1) + " ", end="")
            for j in range(РазмерПоля):
                print(поле[i][j] + " ", end="")
            print()
        
        # Проверка выигрыша
        выиграл = False
        
        # Проверяем строки
        for i in range(РазмерПоля):
            все_одинаковые = True
            for j in range(РазмерПоля):
                if поле[i][j] != текущий_символ:
                    все_одинаковые = False
                    break
            if все_одинаковые:
                выиграл = True
                break
        
        # Проверяем столбцы
        if not выиграл:
            for j in range(РазмерПоля):
                все_одинаковые = True
                for i in range(РазмерПоля):
                    if поле[i][j] != текущий_символ:
                        все_одинаковые = False
                        break
                if все_одинаковые:
                    выиграл = True
                    break
        
        # Проверяем главную диагональ
        if not выиграл:
            все_одинаковые = True
            for i in range(РазмерПоля):
                if поле[i][i] != текущий_символ:
                    все_одинаковые = False
                    break
            if все_одинаковые:
                выиграл = True
        
        # Проверяем побочную диагональ
        if not выиграл:
            все_одинаковые = True
            for i in range(РазмерПоля):
                if поле[i][РазмерПоля-1-i] != текущий_символ:
                    все_одинаковые = False
                    break
            if все_одинаковые:
                выиграл = True
        
        # Проверка ничьей
        ничья = True
        for i in range(РазмерПоля):
            for j in range(РазмерПоля):
                if поле[i][j] == '.':
                    ничья = False
                    break
            if not ничья:
                break
        
        if выиграл:
            print("\nПоздравляем!", текущий_игрок, "выиграл(а)!")
            игра_закончена = True
        elif ничья:
            print("\nНичья! Поле полностью заполнено.")
            игра_закончена = True
        else:
            # Меняем игроков
            текущий_игрок, следующий_игрок = следующий_игрок, текущий_игрок
            текущий_символ, следующий_символ = следующий_символ, текущий_символ
        
    with open('кто победил.txt', 'w', encoding='utf-8') as file:
        file.write("Победил:" + текущий_игрок)
        


    ПродолжениеИгры = str(input("Переиграть? Да/Нет "))
    
print("Игра окончена!")
